<html>
    <head>
        <style>
            div.container {
                width: 100%;
                border: 1px solid gray;
            }

            header, footer {
                padding: 1em;
                color: white;
                background-color: navy;
                clear: left;
                text-align: center;
            }

            nav {
                float: left;
                max-width: 900px;
                margin: 0;
                padding: 1em;
            }

            nav ul {
                list-style-type: none;
                padding: 0;
            }

            nav ul a {
                text-decoration: none;
            }

            article {
                margin-left: 250px;
                border-left: 1px solid gray;
                padding: 1em;
                overflow: hidden;
            }
        </style>
    </head>
    <body onload="onLoad();">

        <div class="container">

        <header>
           <h1>Kompiuterinė Grafika</h1>
        </header>

        </div>

        <div class="container">
            <nav>
              <p><b>1 atsiskaitymas</b></p>
                  <p>Užduotis:</p>
                <li>Naudojant HTML5 “canvas” pavaizduoti tris besisukančius dantiračius</a></li>
                <li>Du didesni dantiračiai sukibę ir pradžioje nesisuka, o mažesnis “varomasis” dantiratis<br> pastoviai sukasi ir yra valdomas: kai tik prisiliečia prie kito dantiračio – pradeda jį sukti </li>
                <li>Varomojo dantiračio padėtį galima keisti naudojant pelę</li>
                <p><b>Įgyvendinimas</b></p>
                <li>Dantiračiam piešti pasitelkta objektiniu programavimu</li>
                <li>Minimaliem galimiem atstumam tarp dantiračių rasti pasitelkta pitagoro teorema</li>
                <a href="https://github.com/malukasrokas/webGL-HTML5/blob/master/Assignment2/ConnectingGears.html">Kodas</a>

            </nav>
            <article>
                <canvas id="canvas" width="500" height="500" style="border:3px solid black;"></canvas>
                <script>
                var ctx, canvas;
                var edgeLength = 500;
                var dragEnabled = false;
                var rotate = 0;
                                        //  x    y  rad  srad  tn   col
                var BigGear = new Gear    (150, 180, 130, 145, 50, 'orange');
                var SmallGear = new Gear  (327.6, 280, 55, 70, 18, 'blue');
                var TriggerGear = new Gear(250, 400, 23, 36, 7, 'red');

                function init() {

                    canvas = document.getElementById("canvas");
                    ctx = canvas.getContext("2d");
                    return setInterval(drawGears, 1);
                }

                function distanceBetweenLessThanRadiusSum(TriggerGearObj, TouchingGearObj) {



                    if (TouchingGearObj == BigGear)
                        additionalDistance = 7.4;

                    else if (TouchingGearObj == SmallGear)
                        additionalDistance = 4;

                    return (Math.sqrt(Math.pow(TouchingGearObj.xPos - TriggerGearObj.xPos, 2) + Math.pow(TouchingGearObj.yPos - TriggerGearObj.yPos, 2)) <= TriggerGearObj.teethRadius+additionalDistance+TouchingGearObj.radius);
                }

                function drawGears(){


                    rotAngle = Math.PI/180/25;
                    ctx.clearRect(0, 0, edgeLength, edgeLength);

                    SmallGear.enableRotation(rotate, rotAngle*(BigGear.teethNumber/SmallGear.teethNumber));
                    BigGear.enableRotation(rotate*(-1), rotAngle);
                    TriggerGear.enableRotation(1, rotAngle*(BigGear.teethNumber/SmallGear.teethNumber)/0.38875);

                    if (distanceBetweenLessThanRadiusSum(TriggerGear, BigGear)) {
                        rotate = 1;
                        dragEnabled = false;
                    }

                    else if (distanceBetweenLessThanRadiusSum(TriggerGear, SmallGear)) {
                        rotate = -1;
                        dragEnabled = false;
                    }

                    else
                        rotate = 0;
                }

                function Gear(xPos, yPos, radius, teethRadius, teethNumber, color) {

                    var rotationAngle = 0;

                    this.xPos = xPos;
                    this.yPos = yPos;
                    this.radius = radius;
                    this.teethNumber = teethNumber;
                    this.teethRadius = teethRadius;
                    this.color = color;
                    this.drawGear = function drawGear() {

                        var rSmall, rBig;
                        var x, y, spikeX, spikeY;
                        var incSmall = 360/this.teethNumber;
                        var incBig = 360/this.teethNumber/2;

                        ctx.beginPath();
                        ctx.fillStyle = this.color;
                        ctx.arc(0, 0, this.radius, 0, Math.PI*2, true);
                        ctx.fill();

                        ctx.beginPath();
                        ctx.fillStyle = 'white';
                        ctx.arc(0, 0, 10, 0, Math.PI * 2, true);
                        ctx.fill();
                        ctx.stroke();
                        ctx.fillStyle = this.color;
                        rSmall = rBig = 0;

                        for (i = 0; i < this.teethNumber; i++, rSmall+=incSmall) {

                            x = this.radius*Math.cos(Math.PI*rSmall/180);
                            y = this.radius*Math.sin(Math.PI*rSmall/180);

                            spikeX = this.teethRadius*Math.cos(Math.PI*(rSmall+incBig)/180);
                            spikeY = this.teethRadius*Math.sin(Math.PI*(rSmall+incBig)/180);

                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(spikeX, spikeY);
                            ctx.lineTo(this.radius*Math.cos(Math.PI*(rSmall+incSmall)/180), this.radius*Math.sin(Math.PI*(rSmall+incSmall)/180));
                            ctx.fill();
                            ctx.stroke();
                        }
                    }
                    this.enableRotation = function enableRotation(direction, angleIncrement) {

                        rotationAngle += angleIncrement;
                        ctx.save();
                        ctx.translate(this.xPos, this.yPos);

                        switch(direction) {
                            case 0:
                                rotationAngle = 0;
                                break;
                            case -1:
                                ctx.rotate(-rotationAngle);
                                break;
                            case 1:
                                ctx.rotate(rotationAngle);
                                break;
                        }

                        this.drawGear();
                        ctx.restore();


                    }
                }

                function mouseDrag(e) {

                    if (dragEnabled) {
                        TriggerGear.xPos = e.pageX - canvas.offsetLeft;
                        TriggerGear.yPos = e.pageY - canvas.offsetTop;
                    }
                }

                function mouseDown(e) {

                        x = TriggerGear.xPos;
                        y = TriggerGear.yPos;
                        if (e.pageX < x + 20 + canvas.offsetLeft  && e.pageX > x -20 + canvas.offsetLeft &&
                            e.pageY < y + 20 + canvas.offsetTop   && e.pageY > y -20 + canvas.offsetTop )
                        {
                            TriggerGear.xPos = e.pageX - canvas.offsetLeft;
                            TriggerGear.yPos = e.pageY - canvas.offsetTop;
                            dragEnabled = true;
                            canvas.onmousemove = mouseDrag;
                        }
                }

                function mouseUp() {

                    dragEnabled = false;
                    canvas.onmousemove = null;
                }

                init();
                canvas.onmousedown = mouseDown;
                canvas.onmouseup = mouseUp;
                </script>

            </article>
        </div>

    </body>

    <footer>Rokas M.</footer>
</html>
